---
title: "Covid91 vaccine study Final2023"
author: "Ezra Licciardi"
output: 
  html_document:
    number_sections: true
    toc: true
    toc_depth: 5
date: "`r Sys.Date()`" 
---

```{r include=FALSE,echo=FALSE}
require(tidyverse)
require(tigerstats)
require(forcats)
FinalDat <-read.csv(file="final.csv",header=TRUE)
#recode to remove the annoying "X" from the dataframe
FinalData <- FinalDat  %>% select(-one_of("X"))
FinalData <- FinalData %>%
mutate(across(where(is.character), as.factor))

male = filter(FinalData, sex =="M")
female = filter(FinalData, sex =="F")
lgbtq = filter(FinalData, LGBTQ =="gay")
drugUser = filter(FinalData, DrugUser =="yes")

```

# Introduction

A new prospective vaccine for Covid is being produced and is undergoing clinical trials. This vaccine by its nature will effect different sections of the population differently and be more effective for some and less effective for others. The subsets of the population in question for the purposes of this research are: Male, Female, LGBTQ, and Drug Users. Each subset will undergo the same testing for the efficacy of the vaccine to determine its effectiveness.

$H_0$ : There are NO statistically significant difference in the data, meaning the vaccine and placebo are equally as effective.

$H_A$ : There are statistically significant difference in the data, meaning the vaccine and placebo are NOT equally as effective.

# Methods

Looking at the data collected this is going to be a categorical explained by categorical. We will be using the candP helper file to use R studios built in bar charts to graphically display data, then we will be using xtabs to find the measures of center for the data. Because we are only comparing two types of data in this case we will not have to use any loops to measure multiple variables. 

# Results

## Males

### Graphical Results

```{r}
barchartGC(~infected + treatment,data=male)
barchartGC(~infected + treatment,data=male, type="percent")
```

Above is a Barchart comparing the graphical results of only males collected from the data. It is comparing rates of contracting Covid 19 as compared by vaccination status. The left shows people who contracted Covid 19 and the right shows men who have not.

It is clear to see that more than twice the percentage of people who are in the placebo group contracted covid where people who did not contract covid are very closly related. Given the sample size it is unlikely that this happened by chance alone.

### Numerical Results

```{r}
tableMale <- xtabs(~infected + treatment, data=male)
rowPerc(tableMale)
colPerc(tableMale)
```

The numerical results compound on what the graphical results were telling us, the placebo group contracted Covid approximately 70% of the time where the vaccinated group contracted Covid 30% of the time. We can see that the vaccine is generally effective in this testing scenario.

### Inferential Results

```{r}
chisq.test(tableMale)
chisqtestGC(tableMale)
maleFisher <- fisher.test(tableMale)
maleFisher
```

The Chi Squared test shows that the P value for the tested data is substancially smaller than the general use point of 0.05, infact it is $1.098\times10^{-13}$ which is a very small number indicating that these is a difference in the data. The Chi-Squared statistic is also 55, much larger than our degrees of freedom of one from this data. The odds a man NOT getting the vaccine are 2.2 times higher than a man WITH the vaccine contracting covid.

### Confidence Interval

```{r}
oddsMale = maleFisher$estimate/(maleFisher$estimate+1)*100
print(oddsMale)
maleLow=(maleFisher$conf.int[1]/(maleFisher$conf.int[1]+1))*100
maleHigh=(maleFisher$conf.int[2]/(maleFisher$conf.int[2]+1))*100
cat("\n","Condifence interval for Males: ",maleLow," to ",maleHigh)
```

### Conclusion

We can reject the $H_0$ in this case in favor of the $H_A$ for this case and determine that the vaccine is effective in the male group given the graphical, numerical, and inferential results collected from the data.

## Females

### Graphical Results

```{r}
barchartGC(~infected + treatment,data=female)
barchartGC(~infected + treatment,data=female, type="percent")
```

Above is a Barchart comparing the graphical results of only famales collected from the data. It is comparing rates of contracting Covid 19 as compared by vaccination status. The left shows women who contracted Covid 19 and the right shows women who have not.

It is clear to see that approximately one third more of the percentage of people who are in the placebo group contracted covid. Where people who did not contract covid are very closely related. 

### Numerical Results

```{r}
tableFemale <- xtabs(~infected + treatment, data=female)
rowPerc(tableFemale)
colPerc(tableFemale)
```

The numerical results compound on what the graphical results were telling us, the placebo group contracted Covid approximately 60% of the time where the vaccinated group contracted Covid 40% of the time. We can see that the vaccine is generally effective in this testing scenario, although it is less effective then the male participants.

### Inferential Results

```{r}
chisq.test(tableFemale)
chisqtestGC(tableFemale)
femaleFisher <- fisher.test(tableFemale)
femaleFisher
```

The Chi Squared test shows that the P value for the tested data is smaller than the general use point of 0.05, infact it is $2.732\times10^{-4}$ which is a small number indicating that these is a difference in the data. The Chi-Squared statistic is also 13, being larger than our degrees of freedom of one from this data. The odds a man NOT getting the vaccine are 1.4 times higher than a man WITH the vaccine contracting covid.

### Confidence Interval

```{r}
oddsFemale = femaleFisher$estimate/(femaleFisher$estimate +1)*100
print(oddsFemale)
femaleLow=(femaleFisher$conf.int[1]/(femaleFisher$conf.int[1]+1))*100
femaleHigh=(femaleFisher$conf.int[2]/(femaleFisher$conf.int[2]+1))*100
cat("\n","Condifence interval for Females: ",femaleLow," to ",femaleHigh)
```

### Conclusion

We can reject the $H_0$ in this case in favor of the $H_A$ for this case and determine that the vaccine is also effective in the female group given the graphical, numerical, and inferential results collected from the data.

## LGBTQ

### Graphical Results

```{r}
barchartGC(~infected + treatment,data=lgbtq)
barchartGC(~infected + treatment,data=lgbtq, type="percent")
```

Above is a Barchart comparing the graphical results of only drug users collected from the data. It is comparing rates of contracting Covid 19 as compared by vaccination status. The left shows people who contracted Covid 19 and the right shows people who have not.

Once again, it is clear to see that substantially more people who are in the vaccinated group contracted covid. Where people who did not contract covid are very closely related. Given the sample size it is unlikely that this happened by chance alone.

### Numerical Results

```{r}
tableLGBTQ <- xtabs(~infected + treatment, data=lgbtq)
rowPerc(tableLGBTQ)
colPerc(tableLGBTQ)
```

The numerical results compound on what the graphical results were telling us, the placebo group contracted Covid approximately 15% of the time where the vaccinated group contracted Covid 85% of the time. We can see that the vaccine is NOT effective in this testing scenario, in fact it is inversely effective and seems to put this group at a higher risk of contracting covid.

### Inferential Results

```{r}
chisq.test(tableLGBTQ)
chisqtestGC(tableLGBTQ)
lgbtqFisher <- fisher.test(tableLGBTQ)
lgbtqFisher
```

### Confidence Interval

```{r}
oddsLGBTQ = lgbtqFisher$estimate/(lgbtqFisher$estimate +1)*100
print(oddsLGBTQ)
lgbtqLow=(lgbtqFisher$conf.int[1]/(lgbtqFisher$conf.int[1]+1))*100
lgbtqHigh=(lgbtqFisher$conf.int[2]/(lgbtqFisher$conf.int[2]+1))*100
cat("\n","Condifence interval for LGBTQ: ",lgbtqLow," to ",lgbtqHigh)
```

## Drug Users

### Graphical Results

```{r}
barchartGC(~infected + treatment,data=drugUser)
barchartGC(~infected + treatment,data=drugUser, type="percent")
```

### Numerical Results

```{r}
tableDrug <- xtabs(~infected + treatment, data=drugUser)
rowPerc(tableDrug)
colPerc(tableDrug)
```

The numerical results compound on what the graphical results were telling us, the placebo group contracted Covid approximately 10% of the time where the vaccinated group contracted Covid 90% of the time. We can see that the vaccine is NOT effective in this testing scenario, in fact it is inversely effective and seems to put this group at a higher risk of contracting covid. This group suffers from even more ill effects than the already negatively effected LGBTQ group.

### Inferential Results

```{r}
chisq.test(tableDrug)
chisqtestGC(tableDrug)
drugFisher <- fisher.test(tableDrug)
drugFisher
```

### Confidence Interval

```{r}
oddsDrug = drugFisher$estimate/(drugFisher$estimate +1)*100
print(oddsDrug)
drugLow=(drugFisher$conf.int[1]/(drugFisher$conf.int[1]+1))*100
drugHigh=(drugFisher$conf.int[2]/(drugFisher$conf.int[2]+1))*100
cat("\n","Condifence interval for Drug Users: ",drugLow," to ",drugHigh)
```

# Overall Results and Conclusions